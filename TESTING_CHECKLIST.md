# 用户下拉列表优化 - 测试清单

## 测试环境准备

### 测试账户
1. **普通用户（未订阅）**
   - role: 'user'
   - subscription_type: null
   - subscription_expires_at: null

2. **普通用户（已订阅）**
   - role: 'user'
   - subscription_type: 'monthly'
   - subscription_expires_at: '2025-12-31T00:00:00Z'

3. **管理员用户（未订阅）**
   - role: 'admin'
   - subscription_type: null
   - subscription_expires_at: null

4. **管理员用户（已订阅）**
   - role: 'admin'
   - subscription_type: 'monthly'
   - subscription_expires_at: '2025-12-31T00:00:00Z'

## 功能测试

### 测试1: Admin按钮显示（管理员）
- [ ] 使用管理员账户登录
- [ ] 点击右上角用户图标
- [ ] 验证下拉菜单中显示"管理后台"按钮
- [ ] 验证按钮位于邮箱下方，仪表盘上方
- [ ] 验证按钮使用Shield图标
- [ ] 点击按钮，验证跳转到/admin页面

### 测试2: Admin按钮隐藏（普通用户）
- [ ] 使用普通用户账户登录
- [ ] 点击右上角用户图标
- [ ] 验证下拉菜单中不显示"管理后台"按钮

### 测试3: 订阅按钮（未订阅用户）
- [ ] 使用未订阅账户登录
- [ ] 点击右上角用户图标
- [ ] 验证显示"订阅"按钮（不是"退订"）
- [ ] 验证按钮使用CreditCard图标
- [ ] 点击按钮，验证跳转到/payment页面

### 测试4: 退订按钮（已订阅用户）
- [ ] 使用已订阅账户登录
- [ ] 点击右上角用户图标
- [ ] 验证显示"退订"按钮（不是"订阅"）
- [ ] 验证按钮使用Bell图标

### 测试5: 退订确认对话框
- [ ] 使用已订阅账户登录
- [ ] 点击"退订"按钮
- [ ] 验证弹出确认对话框
- [ ] 验证对话框标题为"确认取消订阅"
- [ ] 验证对话框描述清晰说明退订影响
- [ ] 验证有"取消"和"确认退订"两个按钮
- [ ] 验证"确认退订"按钮为红色

### 测试6: 取消退订
- [ ] 打开退订确认对话框
- [ ] 点击"取消"按钮
- [ ] 验证对话框关闭
- [ ] 验证订阅状态未改变
- [ ] 再次打开下拉菜单，验证仍显示"退订"按钮

### 测试7: 确认退订（成功）
- [ ] 打开退订确认对话框
- [ ] 点击"确认退订"按钮
- [ ] 验证按钮显示"处理中..."
- [ ] 验证按钮被禁用
- [ ] 等待处理完成
- [ ] 验证显示成功提示Toast
- [ ] 验证对话框自动关闭
- [ ] 再次打开下拉菜单，验证显示"订阅"按钮（不是"退订"）

### 测试8: 确认退订（失败）
- [ ] 断开网络或模拟错误
- [ ] 打开退订确认对话框
- [ ] 点击"确认退订"按钮
- [ ] 验证显示错误提示Toast
- [ ] 验证对话框保持打开
- [ ] 验证可以重试

### 测试9: 多语言支持（中文）
- [ ] 切换到中文
- [ ] 验证"管理后台"显示正确
- [ ] 验证"订阅"/"退订"显示正确
- [ ] 验证对话框标题和描述为中文
- [ ] 验证按钮文字为中文
- [ ] 验证Toast提示为中文

### 测试10: 多语言支持（英文）
- [ ] 切换到英文
- [ ] 验证"Admin"显示正确
- [ ] 验证"Subscribe"/"Unsubscribe"显示正确
- [ ] 验证对话框标题和描述为英文
- [ ] 验证按钮文字为英文
- [ ] 验证Toast提示为英文

### 测试11: 下拉菜单结构
- [ ] 验证菜单项顺序正确：
  1. 用户邮箱
  2. 分隔线
  3. 管理后台（仅管理员）
  4. 分隔线（仅管理员）
  5. 仪表盘
  6. 重设密码
  7. 分隔线
  8. 订阅/退订
  9. 分隔线
  10. 隐私政策
  11. 用户协议
  12. Cookie政策
  13. 分隔线
  14. 登出

### 测试12: 响应式设计
- [ ] 在桌面浏览器测试（1920x1080）
- [ ] 在平板设备测试（768x1024）
- [ ] 在手机设备测试（375x667）
- [ ] 验证下拉菜单在所有设备上正常显示
- [ ] 验证对话框在所有设备上正常显示

### 测试13: 无障碍访问
- [ ] 使用键盘Tab键导航
- [ ] 验证可以用键盘打开下拉菜单
- [ ] 验证可以用键盘选择菜单项
- [ ] 验证可以用键盘操作对话框
- [ ] 使用屏幕阅读器测试

### 测试14: 边界情况
- [ ] 测试未登录用户（不显示下拉菜单）
- [ ] 测试profile为null的情况
- [ ] 测试subscription_type为其他值的情况
- [ ] 测试网络延迟情况
- [ ] 测试快速重复点击

## 性能测试

### 测试15: 加载性能
- [ ] 测试下拉菜单打开速度
- [ ] 测试对话框打开速度
- [ ] 测试退订API响应时间
- [ ] 测试用户资料刷新速度

## 安全测试

### 测试16: 权限验证
- [ ] 验证普通用户无法访问/admin页面
- [ ] 验证退订API需要用户认证
- [ ] 验证只能退订自己的订阅

## 集成测试

### 测试17: 与其他功能集成
- [ ] 退订后访问Dashboard，验证功能正常
- [ ] 退订后访问Training，验证权限正确
- [ ] 退订后访问Tests，验证权限正确
- [ ] 重新订阅后，验证权限恢复

## 回归测试

### 测试18: 原有功能
- [ ] 验证仪表盘按钮正常工作
- [ ] 验证重设密码按钮正常工作
- [ ] 验证政策页面链接正常工作
- [ ] 验证登出功能正常工作
- [ ] 验证语言切换功能正常工作

## 测试结果记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 测试1 | ⬜ |  |
| 测试2 | ⬜ |  |
| 测试3 | ⬜ |  |
| 测试4 | ⬜ |  |
| 测试5 | ⬜ |  |
| 测试6 | ⬜ |  |
| 测试7 | ⬜ |  |
| 测试8 | ⬜ |  |
| 测试9 | ⬜ |  |
| 测试10 | ⬜ |  |
| 测试11 | ⬜ |  |
| 测试12 | ⬜ |  |
| 测试13 | ⬜ |  |
| 测试14 | ⬜ |  |
| 测试15 | ⬜ |  |
| 测试16 | ⬜ |  |
| 测试17 | ⬜ |  |
| 测试18 | ⬜ |  |

## 测试通过标准

- ✅ 所有功能按预期工作
- ✅ 无UI显示问题
- ✅ 无性能问题
- ✅ 无安全漏洞
- ✅ 多语言支持完整
- ✅ 响应式设计正常
- ✅ 无障碍访问良好
- ✅ 错误处理完善

## 已知问题

（测试过程中发现的问题记录在此）

## 测试人员

- 姓名：
- 日期：
- 签名：
